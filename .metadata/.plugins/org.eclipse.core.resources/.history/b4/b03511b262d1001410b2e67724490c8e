package uefs.redes.controller;

import java.io.IOException;
import java.io.ObjectOutputStream;
import java.net.Socket;
import java.net.UnknownHostException;

import uefs.redes.define.Constants;
import uefs.redes.define.Pack;
import uefs.redes.model.ClientAcess;
import uefs.redes.servidorArquivo.ClientTransferation;

public class ControllerCliente {
	
	private ClientAcess client_acess;
	private Socket client_socket ;
	
	public void to_connect() throws UnknownHostException, IOException
	{
		this.client_socket = new Socket (Constants.HOST,Constants.PORT_ACESS);
		client_acess = new ClientAcess(this.client_socket,this);
		Thread threadClient = new Thread(client_acess);
		threadClient.start();
	}

	public void to_send_pack(Object pack) throws IOException, InterruptedException
	{
		ObjectOutputStream out = new ObjectOutputStream(client_socket.getOutputStream());
		out.writeObject(pack);
		out.flush();
		//Thread.sleep(1000);
	}
	public void to_login(String name, String password) throws IOException, InterruptedException
	{
		Pack login_pack = new Pack(Constants.LOGIN_REQ);
		login_pack.addOneByOne(name);
		login_pack.addOneByOne(password);
		this.to_send_pack(login_pack);
	}
	
	public void to_search(String datagrams) throws IOException, InterruptedException
	{
		Pack search_pack = new Pack(Constants.SEARCH_REQ);
		search_pack.addOneByOne(datagrams);
		
		this.to_send_pack(search_pack);
	}
	public void to_logout() throws IOException, InterruptedException
	{
		Pack logout_pack = new Pack(Constants.LOGOUT_REQ);
		
		this.to_send_pack(logout_pack);
	}
	public void to_watch() throws UnknownHostException, IOException, InterruptedException
	{
		Pack download_pack = new Pack(Constants.DOWNLOAD_REQ);
		
		ClientTransferation client_channel = to_send_pack_file(download_pack);
		
		client_channel.getFileFromServeR();
		
	}
	public ClientTransferation to_send_pack_file(Object pack) throws IOException, InterruptedException
	{
		Socket client_socket_file = new Socket(Constants.HOST,Constants.PORT_FILE);
		
		ClientTransferation client_channel= new ClientTransferation(client_socket_file);		
		ObjectOutputStream out = new ObjectOutputStream(client_socket_file.getOutputStream());
		
		out.writeObject(pack);
		out.flush();
		
		return client_channel;
	}
}
